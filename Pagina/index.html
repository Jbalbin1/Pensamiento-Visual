<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prototipo â€” VisualizaciÃ³n de datos</title>
  <link rel="stylesheet" href="css/styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>
</head>
<body>
  <!-- Header compartido -->
  <div id="header-placeholder"></div>
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-placeholder").innerHTML = html;

        // === Scroll-spy: resalta el botÃ³n segÃºn secciÃ³n visible ===
        const sections = [
          document.getElementById("inicio"),
          document.getElementById("stats"),
          document.getElementById("motivacion"),
        ].filter(Boolean);

        const linkMap = new Map();
        // Mapea href -> <a>
        document.querySelectorAll('.topbar .nav .btn').forEach(a => {
          const hash = (a.getAttribute('href') || '').split('#')[1];
          if (hash && document.getElementById(hash)) linkMap.set(hash, a);
        });

        const setActive = (id) => {
          document.querySelectorAll('.topbar .nav .btn').forEach(a => a.classList.remove('is-active'));
          const btn = linkMap.get(id);
          if (btn) btn.classList.add('is-active');
        };

        // Observa quÃ© secciÃ³n estÃ¡ en viewport
        const obs = new IntersectionObserver((entries) => {
          // ordena por intersecciÃ³n y escoge la mÃ¡s visible
          const visible = entries
            .filter(e => e.isIntersecting)
            .sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
          if (visible) setActive(visible.target.id);
        }, { rootMargin: '-20% 0px -60% 0px', threshold: [0.25, 0.6, 0.9] });

        sections.forEach(sec => obs.observe(sec));

        // Al hacer click, marcar al tiro (mejor UX)
        document.querySelectorAll('.topbar .nav .btn[href*="#"]').forEach(a => {
          a.addEventListener('click', () => {
            const id = a.getAttribute('href').split('#')[1];
            if (id) setActive(id);
          });
        });
      });
  </script>

<section id="inicio" class="section hero">
  <div class="container">
    <div class="hero-badges">
      <span class="badge">Datos reales</span>
      <span class="badge">Chile</span>
      <span class="badge">Bienestar</span>
    </div>

    <h1>Â¿QuÃ© buscamos?</h1>
    <p class="lead">
      Que al explorar estos datos <strong>te hagas preguntas</strong>, 
      <strong>converses</strong> y <strong>mires tu entorno con otros ojos</strong>.
      Queremos una ciudadanÃ­a joven mÃ¡s <em>crÃ­tica, empÃ¡tica</em> y con ganas de participar.
    </p>

    <div class="callout">
      <p><strong>En simple:</strong> no es solo â€œinformarâ€, es <strong>mover</strong> a la reflexiÃ³n y al compromiso.</p>
    </div>

    <h2>Â¿Por quÃ©?</h2>
    <ul class="hero-list">
      <li>Porque la VIF y los delitos <strong>pegan directo</strong> en cÃ³mo sentimos nuestra vida.</li>
      <li>Porque muchas veces se ven como â€œlo normalâ€â€¦ y no lo son.</li>
      <li>Porque con info clara podemos <strong>entender, cuestionar y conversar</strong>.</li>
    </ul>

    <h2>Â¿QuÃ© es la satisfacciÃ³n de la vida?</h2>
    <p>
      Es cÃ³mo <strong>evalÃºas tu vida hoy</strong> (salud, seguridad, relaciones, estudio, trabajo, etc.). 
      No es solo â€œestar felizâ€: es una mirada global de tu bienestar.
    </p>
  </div>
</section>


  <main class="grid" id="stats">
  
    <div id="DelitosVIFSatisfacciÃ³n">
      <h1>Delitos, VIF y SatisfacciÃ³n:</h1>
      <div class="controls">
        <label for="yearSel"></label>
        <select id="yearSel"></select>
      </div>
    </div>

    <section class="panel">
      <div id="MapaRegion">
        <h2>Mapa por satisfacciÃ³n</h2>
      </div>
      <div class="stage">
        <svg id="mapSvg" viewBox="0 0 700 1000" preserveAspectRatio="xMidYMid meet">
          <g id="mapGroup"></g>
        </svg>
      </div>
    </section>

    <section class="panel">
      <div id="Mapaburbujas">
        <h2>Delitos vs VIF (burbujas)</h2>
      </div>
      <div class="stage">
        <svg id="bubbleSvg" viewBox="0 0 900 600" preserveAspectRatio="xMidYMid meet"></svg>
      </div>
    </section>

    <section class="panel panel-detail">
      <div id="detailBox" class="detail-box" hidden>
        <h1 id="detailTitle">Detalle â€” RegiÃ³n</h1>

        <!-- regiÃ³n duplicada (mÃ¡s pequeÃ±a) -->
        <svg id="detailRegionSvg" width="220" height="140"></svg>

        <!-- KPIs principales -->
        <div class="kpi-row">
          <div class="kpi">
            <div class="icon">ğŸ˜Š</div>
            <div class="value" id="satValue">â€”</div>
            <div class="sub">SatisfacciÃ³n</div>
            <div class="rank" id="satRank">â€”</div>
          </div>
          <div class="kpi">
            <div class="icon">ğŸ </div>
            <div class="value" id="vifValue">â€”</div>
            <div class="sub">VIF</div>
            <div class="rank" id="vifRank">â€”</div>
          </div>
          <div class="kpi">
            <div class="icon">ğŸ”—</div>
            <div class="value" id="delValue">â€”</div>
            <div class="sub">Delitos</div>
            <div class="rank" id="delRank">â€”</div>
          </div>
        </div>

        <!-- 2 tarjetas: VIF desglosado y delitos estudiados -->
        <div class="cards-2">
          <div class="card">
            <h4>Violencia intrafamiliar</h4>
            <div class="pill">
              <span>PsicolÃ³gica</span>
              <strong id="vifPsico">â€”</strong>
            </div>
            <div class="pill">
              <span>FÃ­sica</span>
              <strong id="vifFisica">â€”</strong>
            </div>
          </div>

          <div class="card">
            <h4>Delitos estudiados</h4>
            <ul id="delitosList" class="bullets"></ul>
          </div>
        </div>

        <button id="closeDetail" class="close-detail">Cerrar</button>
      </div>
    </section>

  </main>
<section id="motivacion" class="section motivation">
  <div class="container">
    <h2>Â¿QuÃ© puedo hacer como individuo?</h2>

    <div class="tips tips-big">
      <div class="tip">
        <h3>1) Habla del tema</h3>
        <p>Conversar de VIF y delitos <strong>rompe el silencio</strong> y ayuda a ver seÃ±ales a tiempo.</p>
      </div>
      <div class="tip">
        <h3>2) Arma red</h3>
        <p>Escucha sin juzgar, comparte info de ayuda y acompaÃ±a. <strong>No estÃ¡s sol@.</strong></p>
      </div>
      <div class="tip">
        <h3>3) Participa</h3>
        <p>Centro de estudiantes, juntas, campaÃ±as locales. <strong>PequeÃ±as acciones = grandes cambios.</strong></p>
      </div>
      <div class="tip">
        <h3>4) Respeto siempre</h3>
        <p>LÃ­mites sanos, empatÃ­a, cero tolerancia a la violencia. <strong>Parte por tu cÃ­rculo.</strong></p>
      </div>
      <div class="tip">
        <h3>5) Denuncia responsable</h3>
        <p>Si hay riesgo, <strong>busca apoyo adulto</strong>, autoridades o lÃ­neas de ayuda.</p>
      </div>
      <div class="tip highlight">
        <h3>Tip extra</h3>
        <p>Usa estos datos para <strong>conversar en clases</strong>, hacer proyectos o propuestas en tu comunidad.</p>
      </div>
    </div>

    <div class="cta-row">
      <p class="cta-text">La informaciÃ³n es poder cuando se vuelve <strong>acciÃ³n</strong>.</p>
      <a href="#stats" class="btn cta-btn">Ir a explorar datos</a>
    </div>
  </div>
</section>
  <script src="js/bubbles.js"></script>
  <script src="js/map.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
